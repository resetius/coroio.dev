\doxysection{base.\+hpp}
\hypertarget{base_8hpp_source}{}\label{base_8hpp_source}\index{coroio/base.hpp@{coroio/base.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <stdexcept>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <cstring>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <coroutine>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <tuple>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <time.h>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{namespace\ }NNet\ \{}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{using\ }TClock\ =\ std::chrono::steady\_clock;}
\DoxyCodeLine{00015\ \textcolor{keyword}{using\ }TTime\ =\ TClock::time\_point;}
\DoxyCodeLine{00016\ \textcolor{keyword}{using\ }THandle\ =\ std::coroutine\_handle<>;}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_n_net_1_1_t_timer}{TTimer}}\ \{}
\DoxyCodeLine{00019\ \ \ \ \ TTime\ Deadline;}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ Id;}
\DoxyCodeLine{00021\ \ \ \ \ THandle\ Handle;}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordtype}{bool}\ operator<(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_n_net_1_1_t_timer}{TTimer}}\&\ e)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::tuple(Deadline,\ Id,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{bool}\textcolor{keyword}{>}(Handle))\ >\ std::tuple(e.Deadline,\ e.Id,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{bool}\textcolor{keyword}{>}(e.Handle));}
\DoxyCodeLine{00024\ \ \ \ \ \}}
\DoxyCodeLine{00025\ \};}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_n_net_1_1_t_handle_pair}{THandlePair}}\ \{}
\DoxyCodeLine{00028\ \ \ \ \ THandle\ Read;}
\DoxyCodeLine{00029\ \ \ \ \ THandle\ Write;}
\DoxyCodeLine{00030\ \ \ \ \ THandle\ RHup;}
\DoxyCodeLine{00031\ \};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_n_net_1_1_t_event}{TEvent}}\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordtype}{int}\ Fd;}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ READ\ =\ 1,}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ WRITE\ =\ 2,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ RHUP\ =\ 4}
\DoxyCodeLine{00039\ \ \ \ \ \};}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{int}\ Type;}
\DoxyCodeLine{00041\ \ \ \ \ THandle\ Handle;}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{bool}\ Match(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_n_net_1_1_t_event}{TEvent}}\&\ other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Fd\ ==\ other.Fd\ \&\&\ (Type\ \&\ other.Type);}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ \};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T1,\ \textcolor{keyword}{typename}\ T2>}
\DoxyCodeLine{00049\ \textcolor{keyword}{inline}\ std::tuple<T1,\ T2>}
\DoxyCodeLine{00050\ GetDurationPair(TTime\ now,\ TTime\ deadline,\ std::chrono::milliseconds\ maxDuration)}
\DoxyCodeLine{00051\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{if}\ (now\ >\ deadline)\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_tuple(T1(0),\ T2(0));}
\DoxyCodeLine{00054\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ duration\ =\ (deadline\ -\/\ now);}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (duration\ >\ maxDuration)\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ duration\ =\ maxDuration;}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ part1\ =\ std::chrono::duration\_cast<T1>(duration);}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ duration\ -\/=\ part1;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ part2\ =\ std::chrono::duration\_cast<T2>(duration);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_tuple(part1,part2);}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{keyword}{inline}\ timespec\ GetTimespec(TTime\ now,\ TTime\ deadline,\ std::chrono::milliseconds\ maxDuration)}
\DoxyCodeLine{00068\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{auto}\ [p1,\ p2]\ =\ GetDurationPair<std::chrono::seconds,\ std::chrono::nanoseconds>(now,\ deadline,\ maxDuration);}
\DoxyCodeLine{00070\ \ \ \ \ timespec\ ret;}
\DoxyCodeLine{00071\ \ \ \ \ ret.tv\_sec\ =\ p1.count();}
\DoxyCodeLine{00072\ \ \ \ \ ret.tv\_nsec\ =\ p2.count();}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \}\ \textcolor{comment}{//\ namespace\ NNet}}

\end{DoxyCode}
